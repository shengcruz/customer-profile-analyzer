<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢æˆ·ç”»åƒåˆ†æå™¨ @zs_space</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; color: white; margin-bottom: 30px; }
        header h1 { font-size: 2.2rem; margin-bottom: 8px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        header p { font-size: 1.1rem; opacity: 0.9; }
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        @media (max-width: 900px) { .main-content { grid-template-columns: 1fr; } }
        .panel { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
        .panel-title { font-size: 1.2rem; color: #333; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #667eea; }

        /* å®¢æˆ·ä¿¡æ¯è¡¨å• */
        .customer-info { margin-bottom: 20px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .info-item { display: flex; flex-direction: column; }
        .info-item label { font-size: 13px; color: #666; margin-bottom: 4px; }
        .info-item input, .info-item select {
            padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;
        }
        .info-item input:focus, .info-item select:focus { outline: none; border-color: #667eea; }
        .info-hint { font-size: 12px; color: #999; margin-top: 8px; text-align: center; }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            border: 2px dashed #ddd; border-radius: 12px; padding: 30px;
            text-align: center; cursor: pointer; background: #fafafa; margin-bottom: 16px;
        }
        .upload-area:hover { border-color: #667eea; background: #f0f4ff; }
        .upload-icon { font-size: 40px; margin-bottom: 10px; }
        .upload-text { color: #666; font-size: 14px; }
        .upload-text span { color: #667eea; font-weight: 600; }

        /* å›¾ç‰‡é¢„è§ˆ */
        .preview-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px; margin-bottom: 16px; }
        .preview-item { position: relative; aspect-ratio: 1; border-radius: 6px; overflow: hidden; }
        .preview-item img { width: 100%; height: 100%; object-fit: cover; }
        .preview-item .remove-btn {
            position: absolute; top: 2px; right: 2px; width: 20px; height: 20px;
            background: rgba(255,0,0,0.8); color: white; border: none; border-radius: 50%;
            cursor: pointer; font-size: 12px; line-height: 20px; display: none;
        }
        .preview-item:hover .remove-btn { display: block; }
        .image-count { display: inline-block; background: #667eea; color: white; padding: 3px 10px; border-radius: 15px; font-size: 13px; margin-bottom: 10px; }

        /* æŒ‰é’® */
        .analyze-btn {
            width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;
        }
        .analyze-btn:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .analyze-btn:disabled { opacity: 0.6; cursor: not-allowed; }

        /* è¿›åº¦ */
        .progress-section { display: none; margin-top: 16px; }
        .progress-section.active { display: block; }
        .progress-bar { height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden; margin-bottom: 8px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); width: 0%; transition: width 0.5s; }
        .progress-text { text-align: center; color: #666; font-size: 13px; }

        /* ç»“æœåŒºåŸŸ */
        .result-section { display: none; }
        .result-section.active { display: block; }
        .result-content {
            background: #f9f9f9; border-radius: 12px; padding: 20px;
            max-height: 600px; overflow-y: auto; line-height: 1.8; font-size: 14px;
        }
        .result-content h2 { color: #333; font-size: 1.3rem; margin: 20px 0 12px 0; padding-bottom: 6px; border-bottom: 2px solid #667eea; }
        .result-content h2:first-child { margin-top: 0; }
        .result-content h3 { color: #444; font-size: 1.1rem; margin: 16px 0 8px 0; }
        .result-content p { color: #555; margin-bottom: 8px; }
        .result-content ul { margin-left: 20px; margin-bottom: 12px; }
        .result-content li { color: #555; margin-bottom: 4px; }
        .result-content strong { color: #333; }

        /* æ“ä½œæŒ‰é’® */
        .action-buttons { display: flex; gap: 8px; margin-top: 16px; }
        .action-btn { flex: 1; padding: 10px; border: none; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer; }
        .copy-btn { background: #667eea; color: white; }
        .download-btn { background: #28a745; color: white; }
        .reset-btn { background: #dc3545; color: white; }

        /* ç©ºçŠ¶æ€ */
        .empty-state { text-align: center; padding: 50px 20px; color: #888; }
        .empty-state .icon { font-size: 50px; margin-bottom: 16px; }

        /* æ°´å°å’Œæç¤º */
        .watermark { position: fixed; bottom: 20px; right: 20px; color: rgba(255,255,255,0.6); font-size: 14px; }
        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 6px; font-size: 13px; opacity: 0; transition: opacity 0.3s; z-index: 1000; }
        .toast.show { opacity: 1; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å®¢æˆ·ç”»åƒåˆ†æå™¨</h1>
            <p>åˆ†æå®¢æˆ·æœ‹å‹åœˆï¼Œç²¾å‡†é”€å”®äº”æ’ç³»ç»Ÿ</p>
        </header>

        <div class="main-content">
            <div class="panel">
                <h2 class="panel-title">å®¢æˆ·ä¿¡æ¯ä¸æˆªå›¾</h2>

                <!-- å®¢æˆ·å·²çŸ¥ä¿¡æ¯ -->
                <div class="customer-info">
                    <div class="info-grid">
                        <div class="info-item">
                            <label>æ€§åˆ«</label>
                            <select id="gender">
                                <option value="">æœªçŸ¥</option>
                                <option value="ç”·">ç”·</option>
                                <option value="å¥³">å¥³</option>
                            </select>
                        </div>
                        <div class="info-item">
                            <label>å¹´é¾„æ®µ</label>
                            <select id="ageRange">
                                <option value="">æœªçŸ¥</option>
                                <option value="25-35å²">25-35å²</option>
                                <option value="35-45å²">35-45å²</option>
                                <option value="45-55å²">45-55å²</option>
                                <option value="55å²ä»¥ä¸Š">55å²ä»¥ä¸Š</option>
                            </select>
                        </div>
                        <div class="info-item">
                            <label>è¡Œä¸š/èŒä¸š</label>
                            <input type="text" id="industry" placeholder="å¦‚ï¼šé‡‘èã€ITã€åŒ»ç”Ÿ...">
                        </div>
                        <div class="info-item">
                            <label>æˆ¿å±‹é¢ç§¯</label>
                            <select id="houseSize">
                                <option value="">æœªçŸ¥</option>
                                <option value="100ã¡ä»¥ä¸‹">100ã¡ä»¥ä¸‹</option>
                                <option value="100-150ã¡">100-150ã¡</option>
                                <option value="150-200ã¡">150-200ã¡</option>
                                <option value="200-300ã¡">200-300ã¡</option>
                                <option value="300ã¡ä»¥ä¸Š/åˆ«å¢…">300ã¡ä»¥ä¸Š/åˆ«å¢…</option>
                            </select>
                        </div>
                        <div class="info-item">
                            <label>æˆ¿å±‹ç±»å‹</label>
                            <select id="houseType">
                                <option value="">æœªçŸ¥</option>
                                <option value="æ–°æˆ¿è£…ä¿®">æ–°æˆ¿è£…ä¿®</option>
                                <option value="äºŒæ‰‹æˆ¿ç¿»æ–°">äºŒæ‰‹æˆ¿ç¿»æ–°</option>
                                <option value="å·²å…¥ä½æ”¹é€ ">å·²å…¥ä½æ”¹é€ </option>
                                <option value="åˆ«å¢…">åˆ«å¢…</option>
                            </select>
                        </div>
                        <div class="info-item">
                            <label>å­å¥³æƒ…å†µ</label>
                            <select id="children">
                                <option value="">æœªçŸ¥</option>
                                <option value="æ— å­å¥³">æ— å­å¥³</option>
                                <option value="æœ‰å©´å¹¼å„¿(0-3å²)">æœ‰å©´å¹¼å„¿(0-3å²)</option>
                                <option value="æœ‰å­¦é¾„å„¿ç«¥">æœ‰å­¦é¾„å„¿ç«¥</option>
                                <option value="æœ‰é’å°‘å¹´">æœ‰é’å°‘å¹´</option>
                                <option value="å­å¥³å·²æˆå¹´">å­å¥³å·²æˆå¹´</option>
                            </select>
                        </div>
                        <div class="info-item">
                            <label>è€äººèµ¡å…»</label>
                            <select id="elderly">
                                <option value="">æœªçŸ¥</option>
                                <option value="æ— ">æ— </option>
                                <option value="æœ‰ï¼ŒåŒä½">æœ‰ï¼ŒåŒä½</option>
                                <option value="æœ‰ï¼Œä¸åŒä½">æœ‰ï¼Œä¸åŒä½</option>
                            </select>
                        </div>
                        <div class="info-item">
                            <label>å¥åº·å…³æ³¨</label>
                            <input type="text" id="healthConcern" placeholder="å¦‚ï¼šè¿‡æ•ã€é¼»ç‚ã€ç¡çœ å·®...">
                        </div>
                    </div>
                    <p class="info-hint">ä»¥ä¸Šä¿¡æ¯é€‰å¡«ï¼Œå¡«å†™è¶Šå¤šåˆ†æè¶Šç²¾å‡†</p>
                </div>

                <!-- ä¸Šä¼ åŒºåŸŸ -->
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“·</div>
                    <p class="upload-text">æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œï¼Œæˆ– <span>ç‚¹å‡»ä¸Šä¼ </span><br><small>å»ºè®®ä¸Šä¼ 5å¼ ä»¥ä¸Šæœ‹å‹åœˆæˆªå›¾</small></p>
                </div>
                <input type="file" id="fileInput" multiple accept="image/*" hidden>

                <div id="previewContainer" style="display: none;">
                    <span class="image-count" id="imageCount">0 å¼ å›¾ç‰‡</span>
                    <div class="preview-grid" id="previewGrid"></div>
                </div>

                <button class="analyze-btn" id="analyzeBtn" disabled>ç”Ÿæˆé”€å”®ç­–ç•¥</button>

                <div class="progress-section" id="progressSection">
                    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                    <p class="progress-text" id="progressText">æ­£åœ¨åˆ†æå®¢æˆ·ç”»åƒ...</p>
                </div>
            </div>

            <div class="panel">
                <h2 class="panel-title">åˆ†ææŠ¥å‘Š</h2>
                <div class="empty-state" id="emptyState">
                    <div class="icon">ğŸ“Š</div>
                    <p>ä¸Šä¼ å®¢æˆ·æœ‹å‹åœˆæˆªå›¾å<br>AI å°†ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†çš„é”€å”®ç­–ç•¥</p>
                </div>
                <div class="result-section" id="resultSection">
                    <div class="result-content" id="resultContent"></div>
                    <div class="action-buttons">
                        <button class="action-btn copy-btn" id="copyBtn">å¤åˆ¶æŠ¥å‘Š</button>
                        <button class="action-btn download-btn" id="downloadBtn">ä¸‹è½½æŠ¥å‘Š</button>
                        <button class="action-btn reset-btn" id="resetBtn">é‡æ–°åˆ†æ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="watermark">@zs_space</div>
    <div class="toast" id="toast"></div>

    <script>
        const API_CONFIG = {
            apiKey: 'b77a56c1-f6ce-4577-9bb4-a85cc842ad97',
            apiUrl: 'https://ark.cn-beijing.volces.com/api/v3/responses',
            model: 'doubao-seed-1-6-250615'
        };

        let uploadedImages = [];
        let analysisResult = '';

        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const previewGrid = document.getElementById('previewGrid');
        const imageCount = document.getElementById('imageCount');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const emptyState = document.getElementById('emptyState');
        const resultSection = document.getElementById('resultSection');
        const resultContent = document.getElementById('resultContent');
        const toast = document.getElementById('toast');

        // è·å–å®¢æˆ·ä¿¡æ¯
        function getCustomerInfo() {
            const info = [];
            const gender = document.getElementById('gender').value;
            const ageRange = document.getElementById('ageRange').value;
            const industry = document.getElementById('industry').value;
            const houseSize = document.getElementById('houseSize').value;
            const houseType = document.getElementById('houseType').value;
            const children = document.getElementById('children').value;
            const elderly = document.getElementById('elderly').value;
            const healthConcern = document.getElementById('healthConcern').value;

            if (gender) info.push(`æ€§åˆ«ï¼š${gender}`);
            if (ageRange) info.push(`å¹´é¾„æ®µï¼š${ageRange}`);
            if (industry) info.push(`è¡Œä¸š/èŒä¸šï¼š${industry}`);
            if (houseSize) info.push(`æˆ¿å±‹é¢ç§¯ï¼š${houseSize}`);
            if (houseType) info.push(`æˆ¿å±‹ç±»å‹ï¼š${houseType}`);
            if (children) info.push(`å­å¥³æƒ…å†µï¼š${children}`);
            if (elderly) info.push(`è€äººèµ¡å…»ï¼š${elderly}`);
            if (healthConcern) info.push(`å¥åº·å…³æ³¨ï¼š${healthConcern}`);

            return info.length > 0 ? '\n\nã€å·²çŸ¥å®¢æˆ·ä¿¡æ¯ã€‘\n' + info.join('\n') : '';
        }

        // æ„å»ºæç¤ºè¯
        function buildPrompt() {
            const customerInfo = getCustomerInfo();
            return `ä½ æ˜¯ä¸€ä¸ªé¡¶çº§çš„é«˜ç«¯å®¶å±…é”€å”®é¡¾é—®ï¼Œä¸“æ³¨äºäº”æ’ç©ºè°ƒç³»ç»Ÿï¼ˆæ’æ¸©ã€æ’æ¹¿ã€æ’æ°§ã€æ’æ´ã€æ’é™ï¼‰çš„é”€å”®ã€‚

ã€äº”æ’ç³»ç»Ÿæ ¸å¿ƒä»·å€¼ã€‘
- æ’æ¸©ï¼šå…¨å¹´å®¤å†…æ¸©åº¦ä¿æŒ20-26Â°Cï¼Œå‘Šåˆ«å¿½å†·å¿½çƒ­
- æ’æ¹¿ï¼šæ™ºèƒ½æ¹¿åº¦è°ƒèŠ‚40-60%ï¼Œçš®è‚¤ä¸å¹²ç‡¥ã€è¡£ç‰©ä¸å‘éœ‰
- æ’æ°§ï¼š24å°æ—¶æ–°é£ï¼Œå®¤å†…æ°§æ°”å……è¶³ï¼Œä¸æ†‹é—·
- æ’æ´ï¼šå¤šé‡è¿‡æ»¤PM2.5ã€ç”²é†›ã€èŠ±ç²‰ï¼Œå‘µæŠ¤å‘¼å¸å¥åº·
- æ’é™ï¼šé™éŸ³è¿è¡Œï¼Œç¡çœ ä¸è¢«æ‰“æ‰°
${customerInfo}

è¯·æ ¹æ®ä¸Šä¼ çš„æœ‹å‹åœˆæˆªå›¾${customerInfo ? 'å’Œå·²çŸ¥å®¢æˆ·ä¿¡æ¯' : ''}è¿›è¡Œåˆ†æï¼Œè¾“å‡ºä»¥ä¸‹æ ¼å¼çš„æŠ¥å‘Šï¼š

## å®¢æˆ·ç”»åƒåˆ†ææŠ¥å‘Š

### 1. åŸºæœ¬ç”»åƒ
- ç»æµå®åŠ›è¯„ä¼°ï¼šï¼ˆé«˜/ä¸­é«˜/ä¸­ç­‰ï¼‰
- å®¶åº­ç»“æ„åˆ¤æ–­ï¼š
- ç”Ÿæ´»æ–¹å¼ç‰¹ç‚¹ï¼š

### 2. éœ€æ±‚æ´å¯Ÿ
- å¥åº·å…³æ³¨åº¦ï¼š
- å“è´¨ç”Ÿæ´»è¿½æ±‚ï¼š
- æ½œåœ¨ç—›ç‚¹åˆ†æï¼š

### 3. äº”æ’ç³»ç»Ÿä»·å€¼åŒ¹é…

é’ˆå¯¹è¯¥å®¢æˆ·ï¼Œäº”æ’ç³»ç»Ÿå„åŠŸèƒ½çš„ä»·å€¼ï¼š

- **æ’æ¸©ä»·å€¼**ï¼š
- **æ’æ¹¿ä»·å€¼**ï¼š
- **æ’æ°§ä»·å€¼**ï¼š
- **æ’æ´ä»·å€¼**ï¼š
- **æ’é™ä»·å€¼**ï¼š

### 4. é”€å”®ç­–ç•¥å»ºè®®

**æ¨èåˆ‡å…¥ç‚¹**ï¼š

**å¼€åœºè¯æœ¯ç¤ºä¾‹**ï¼š

**æ ¸å¿ƒå–ç‚¹å¼ºè°ƒé¡ºåº**ï¼š
1.
2.
3.

**å¯èƒ½çš„å¼‚è®®åŠåº”å¯¹**ï¼š

### 5. æˆäº¤è¯„ä¼°
- æˆäº¤å¯èƒ½æ€§ï¼šé«˜/ä¸­/ä½
- å…³é”®æˆåŠŸå› ç´ ï¼š
- å»ºè®®è·Ÿè¿›ç­–ç•¥ï¼š`;
        }

        // Event Listeners
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.style.borderColor = '#667eea'; });
        uploadArea.addEventListener('dragleave', e => { e.preventDefault(); uploadArea.style.borderColor = '#ddd'; });
        uploadArea.addEventListener('drop', e => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ddd';
            addImages(Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/')));
        });
        fileInput.addEventListener('change', e => { addImages(Array.from(e.target.files)); fileInput.value = ''; });
        analyzeBtn.addEventListener('click', startAnalysis);
        document.getElementById('copyBtn').addEventListener('click', () => {
            navigator.clipboard.writeText(analysisResult).then(() => showToast('æŠ¥å‘Šå·²å¤åˆ¶'));
        });
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const blob = new Blob([analysisResult], { type: 'text/markdown' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `å®¢æˆ·åˆ†ææŠ¥å‘Š_${new Date().toISOString().slice(0,10)}.md`;
            a.click();
            showToast('æŠ¥å‘Šå·²ä¸‹è½½');
        });
        document.getElementById('resetBtn').addEventListener('click', () => {
            uploadedImages = [];
            analysisResult = '';
            updatePreview();
            resultSection.classList.remove('active');
            emptyState.style.display = 'block';
            progressSection.classList.remove('active');
        });

        function addImages(files) {
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = e => {
                    uploadedImages.push({ file, dataUrl: e.target.result });
                    updatePreview();
                };
                reader.readAsDataURL(file);
            });
        }

        function updatePreview() {
            if (uploadedImages.length === 0) {
                previewContainer.style.display = 'none';
                analyzeBtn.disabled = true;
                return;
            }
            previewContainer.style.display = 'block';
            imageCount.textContent = `${uploadedImages.length} å¼ å›¾ç‰‡`;
            previewGrid.innerHTML = uploadedImages.map((img, i) => `
                <div class="preview-item">
                    <img src="${img.dataUrl}" alt="Preview">
                    <button class="remove-btn" onclick="removeImage(${i})">Ã—</button>
                </div>
            `).join('');
            analyzeBtn.disabled = false;
        }

        window.removeImage = function(index) {
            uploadedImages.splice(index, 1);
            updatePreview();
        };

        async function startAnalysis() {
            if (uploadedImages.length === 0) { showToast('è¯·ä¸Šä¼ è‡³å°‘ä¸€å¼ æˆªå›¾'); return; }

            analyzeBtn.disabled = true;
            progressSection.classList.add('active');
            progressFill.style.width = '30%';
            progressText.textContent = 'æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...';

            try {
                const inputArray = [];
                for (const img of uploadedImages) {
                    inputArray.push({ type: 'input_image', image_url: img.dataUrl });
                }
                inputArray.push({ type: 'input_text', text: buildPrompt() });

                progressFill.style.width = '50%';
                progressText.textContent = 'AI æ­£åœ¨æ·±åº¦åˆ†æ...';

                const response = await fetch(API_CONFIG.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_CONFIG.apiKey}`
                    },
                    body: JSON.stringify({
                        model: API_CONFIG.model,
                        input: [{ role: 'user', content: inputArray }]
                    })
                });

                progressFill.style.width = '80%';

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error?.message || `è¯·æ±‚å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();

                // è§£æè¿”å›ç»“æœ - å¤„ç† responses API çš„ç‰¹æ®Šæ ¼å¼
                let rawText = '';
                if (data.output && Array.isArray(data.output)) {
                    // éå† output æ•°ç»„ï¼Œæ‰¾åˆ° summary_text ç±»å‹çš„å†…å®¹
                    for (const item of data.output) {
                        if (item.type === 'summary_text' && item.text) {
                            rawText = item.text;
                            break;
                        } else if (item.type === 'message' && item.content) {
                            rawText = item.content;
                            break;
                        }
                    }
                    // å¦‚æœè¿˜æ²¡æ‰¾åˆ°ï¼Œå°è¯•å…¶ä»–æ ¼å¼
                    if (!rawText && data.output[0]) {
                        rawText = data.output[0].text || data.output[0].content || JSON.stringify(data.output[0]);
                    }
                } else if (data.choices && data.choices[0]) {
                    rawText = data.choices[0].message?.content || data.choices[0].text || '';
                } else if (typeof data.output === 'string') {
                    rawText = data.output;
                } else {
                    rawText = JSON.stringify(data, null, 2);
                }

                // æ¸…ç†æ–‡æœ¬ï¼šæ›¿æ¢ \n ä¸ºçœŸæ­£çš„æ¢è¡Œï¼Œç§»é™¤å¤šä½™æ ¼å¼
                analysisResult = rawText
                    .replace(/\\n/g, '\n')  // æ›¿æ¢è½¬ä¹‰çš„æ¢è¡Œç¬¦
                    .replace(/\\t/g, '  ')  // æ›¿æ¢åˆ¶è¡¨ç¬¦
                    .replace(/\\\"/g, '"')  // æ›¿æ¢è½¬ä¹‰çš„å¼•å·
                    .trim();

                progressFill.style.width = '100%';
                progressText.textContent = 'åˆ†æå®Œæˆï¼';

                setTimeout(() => {
                    progressSection.classList.remove('active');
                    emptyState.style.display = 'none';
                    resultSection.classList.add('active');
                    resultContent.innerHTML = marked.parse(analysisResult);
                    analyzeBtn.disabled = false;
                }, 500);

            } catch (error) {
                console.error('Analysis error:', error);
                progressSection.classList.remove('active');
                analyzeBtn.disabled = false;
                showToast(`åˆ†æå¤±è´¥: ${error.message}`);
            }
        }

        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
